const mongoose = require("mongoose");

const HBOMSchema = new mongoose.Schema({
    part: String,
    vendor: String,
    product: String,
    version: String,
    update: String,
    edition: String,
    language: String,
    sw_edition: String,
    target_sw: String,
    target_hw: String,
    other: String,
    cpe23: String,
});

const CVSSImpactSchema = new mongoose.Schema({
    severity: String,
    exploitabilityScore: Number,
    impactScore: Number
});

const SBOMSchema = new mongoose.Schema({
    part: String,
    vendor: String,
    product: String,
    version: String,
    update: String,
    edition: String,
    language: String,
    sw_edition: String,
    target_sw: String,
    target_hw: String,
    other: String,
    cpe23: String,
});

const ProjectVulnerabilitySchema = new mongoose.Schema({
    id: { type: String, index: true },
    cveDataMetaIds: String,
    projectId: String,
    component: String,
    description: String,
    reviewed: {
        type: Boolean,
        default: false
    },
    treatment: {
        type: String,
        default: "no treatment"
    },
    validated: {
        type: Boolean,
        default: false
    },
    impact: CVSSImpactSchema,
    hbom: HBOMSchema,
    baseScore: Number,
    baseSeverity: String,
    highlighted: Boolean,
    sbom: SBOMSchema,
    isNotified: {
        type: Boolean,
        default: false
    },
    publishedDate: Date,
    vulnerabilitySource :String,
    isDeleted: {
        type: Boolean,
        default: false
    },
    lastModifiedBy: String,
    reviewedBy: String,
    reviewedDateTime: Date,
    reviewStatusRevokedBy: String,
    reviewedStatusRevokedDateTime: Date,
    treatmentStatusChangedBy: String,
    treatmentPickedDateTime: Date,
    validatedBy: String,
    validatedDateTime: Date,
    validateStatusRevokedBy: String,
    validationRevokedDateTime: Date,
    raisedBy: String,
    linkedWeaknesses:[String],
    vulnerabilityId:String,
}, { timestamps: true });

module.exports = { ProjectVulnerabilitySchema };