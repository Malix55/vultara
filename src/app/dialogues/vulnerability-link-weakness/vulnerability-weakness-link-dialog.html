<div class="headingPosition">
  <h1 mat-dialog-title style="margin-bottom: 0;">Weakness linking Vulnerability: {{this.data.row.no}}
    </h1>
  <button class="dialog-close" mat-button (click)="closeDialog()">X</button>
</div>

<div class="weakness-table-view-container">
  <div id="weakness-table-view">
      <div class="weakness-list-table-container" id="myId">
          <table mat-table [dataSource]="dataSource" matSort multiTemplateDataRows>
              <ng-container matColumnDef="weaknessNumber">
                  <th mat-header-cell *matHeaderCellDef> Weakness No </th>
                  <td mat-cell *matCellDef="let row">
                      {{row.weaknessNumber}}
                  </td>
              </ng-container>
              <ng-container matColumnDef="dateIdentified">
                  <th mat-header-cell *matHeaderCellDef> Date Identified </th>
                  <td mat-cell *matCellDef="let row; let i = renderIndex;">
                      {{row.dateIdentified|date:'yyyy/MM/dd'}}
                  </td>
              </ng-container>
              <ng-container matColumnDef="identificationMethod">
                  <th mat-header-cell *matHeaderCellDef> Identification Method (Source) </th>
                  <td mat-cell *matCellDef="let row; let i = renderIndex;">
                      <!-- <ng-container> -->
                      <mat-form-field appearance="none">
                          <textarea matInput placeholder="Id Method"
                              [(ngModel)]="row.identificationMethod" [readonly]="true"
                              cdkTextareaAutosize #autosize="cdkTextareaAutosize"
                              cdkAutosizeMinRows="1" cdkAutosizeMaxRows="5"></textarea>
                      </mat-form-field>
                  </td>
              </ng-container>
              <ng-container matColumnDef="sourceNotes">
                  <th mat-header-cell *matHeaderCellDef> Source Notes </th>
                  <td mat-cell *matCellDef="let row; let i = renderIndex;"
                      (click)="$event.stopPropagation()">
                      {{row.sourceNotes}}
                  </td>
              </ng-container>
              <ng-container matColumnDef="component">
                  <th mat-header-cell *matHeaderCellDef> Component </th>
                  <td mat-cell *matCellDef="let row; let i = renderIndex;">
                      {{row.component}}
                  </td>
              </ng-container>
              <ng-container matColumnDef="attackSurface">
                  <th mat-header-cell *matHeaderCellDef> Attack Surface(s) </th>
                  <td mat-cell *matCellDef="let row; let i = renderIndex;">
                      {{row.attackSurface}}
                  </td>
              </ng-container>
              <ng-container matColumnDef="asset">
                  <th mat-header-cell *matHeaderCellDef> Asset(s) </th>
                  <td mat-cell *matCellDef="let row; let i = renderIndex;">
                      {{row.asset}}
                  </td>
              </ng-container>
              <ng-container matColumnDef="weaknessDescription">
                  <th mat-header-cell *matHeaderCellDef> Weakness Description </th>
                  <td mat-cell *matCellDef="let row; let i = renderIndex">
                      <textarea class="weakness-description" matInput inputchange
                          placeholder="Description" [(ngModel)]="row.weaknessDescription"
                          [readonly]="true"></textarea>
                  </td>
              </ng-container>
              <ng-container matColumnDef="cweId">
                  <th mat-header-cell *matHeaderCellDef> CWE ID </th>
                  <td mat-cell *matCellDef="let row">
                    <a href="{{'https://cwe.mitre.org/data/definitions/'+row.cweId+'.html'}}"
                    target="_blank">{{row.cweId?'CWE-'+row.cweId:''}}</a>
                  </td>
              </ng-container>
              <ng-container matColumnDef="cweWeaknessType">
                  <th mat-header-cell *matHeaderCellDef> CWE Weakness Type </th>
                  <td mat-cell *matCellDef="let row; let i = renderIndex">
                      {{row.cweWeaknessType}}
                  </td>
              </ng-container>
              <ng-container matColumnDef="cweCategory">
                  <th mat-header-cell *matHeaderCellDef>CWE Category</th>
                  <td mat-cell *matCellDef="let row; let i = renderIndex">
                     {{row.cweWeaknessCategory}}
                  </td>
              </ng-container>
              <ng-container matColumnDef="vulnerabilitiesLinked">
                <th mat-header-cell *matHeaderCellDef>Link to Vulnerability</th>
                <td mat-cell *matCellDef="let row; let i = renderIndex">
                  <mat-checkbox [disabled]="row._id==data.row.vulnerabilityId" [(ngModel)]="row.linked" (change)="linkedChanged($event,row)">
                    {{convertBoolToYesNo(row.linked)}}
                  </mat-checkbox>
                </td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
              <tr mat-row *matRowDef="let row; let i=index; columns: displayedColumns;"
                  class="threat-row" [style.background-color]="row|rowColor" [id]="row._id">
              </tr>
          </table>
          <mat-paginator [pageSize]="5" [pageSizeOptions]="[10, 20, 50]" showFirstLastButtons></mat-paginator>
      </div>
  </div>
</div>
<div class="weaknessDialogButtons">
  <button mat-raised-button color="primary" style="margin-right:17px;" (click)="updateVulnerabilities()">Confirm</button>
  <button mat-raised-button style="margin-right:65px;" (click)="closeDialog()">Cancel</button>
</div>
<ngx-spinner name="vulnerability-spinner"></ngx-spinner>