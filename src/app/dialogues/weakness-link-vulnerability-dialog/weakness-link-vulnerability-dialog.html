<div class="headingPosition">
  <h1 mat-dialog-title>Vulnerability Linking Weakness No:
    {{this.data.weakness.weaknessNumber}}</h1>
  <button class="dialog-close" mat-button (click)="closeDialog()">X</button>
</div>

<div class="vulnerability-table-view-container">
  <div id="vulnerability-table-view">
    <div class="vulnerability-list-table-container" id="myId">
      <table mat-table [dataSource]="dataSource" matSort multiTemplateDataRows>
        <ng-container matColumnDef="no">
          <th mat-header-cell *matHeaderCellDef> No. </th>
          <td mat-cell *matCellDef="let row">
            {{row.no}}
          </td>
        </ng-container>
        <ng-container matColumnDef="component">
          <th mat-header-cell *matHeaderCellDef> Component </th>
          <td mat-cell *matCellDef="let row; let i = renderIndex;">
            <mat-form-field appearance="none">
              <textarea [readonly]="true" matInput placeholder="Component" style="padding-top:10px;" cdkTextareaAutosize
                #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="1" cdkAutosizeMaxRows="6"
                [(ngModel)]="row.component"></textarea>
            </mat-form-field>
          </td>
        </ng-container>
        <ng-container matColumnDef="swhw">
          <th mat-header-cell *matHeaderCellDef> SW/HW </th>
          <td mat-cell *matCellDef="let row; let i = renderIndex;">
            <!-- <ng-container> -->
            <mat-form-field appearance="none">
              <textarea matInput placeholder="SW/HW" [(ngModel)]="row.swhw" [readonly]="true" cdkTextareaAutosize
                #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="1" cdkAutosizeMaxRows="6"></textarea>
            </mat-form-field>
            <!-- <mat-button-toggle-group class="swhw" (change)="swhwChanged($event, row)" *ngIf="row.vulnerabilitySource =='userManual'" name="swhw" aria-label="swhw">
                <mat-button-toggle checked="true" value="sw">SW</mat-button-toggle>
                <mat-button-toggle value="hw">HW</mat-button-toggle>
              </mat-button-toggle-group> -->
          </td>
        </ng-container>
        <ng-container matColumnDef="cveid">
          <th mat-header-cell *matHeaderCellDef> CVE ID </th>
          <td mat-cell *matCellDef="let row; let i = renderIndex;" (click)="$event.stopPropagation()">
            <a href="{{'https://nvd.nist.gov/vuln/detail/'+ row.cveDataMetaIds}}"
              target="_blank">{{row.cveDataMetaIds}}</a>

            <!-- <mat-form-field appearance="none">
                <textarea matInput inputchange placeholder="CVE ID" class="cveTextArea"
                cdkTextareaAutosize #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="1" cdkAutosizeMaxRows="6"
                ></textarea>
              </mat-form-field>
             -->
          </td>
        </ng-container>
        <ng-container matColumnDef="publishDate">
          <th mat-header-cell *matHeaderCellDef> Published Date </th>
          <td mat-cell *matCellDef="let row; let i = renderIndex;">
            {{row.publishedDate|date:'shortDate'}}
          </td>
        </ng-container>
        <ng-container matColumnDef="description">
          <th mat-header-cell *matHeaderCellDef> Description </th>
          <td mat-cell *matCellDef="let row; let i = renderIndex;">
            <textarea class="vulnerability-description" matInput inputchange placeholder="Description"
              [(ngModel)]="row.description" [readonly]="true"></textarea>
          </td>
        </ng-container>
        <ng-container matColumnDef="baseScore">
          <th mat-header-cell *matHeaderCellDef> Base Score </th>
          <td mat-cell *matCellDef="let row; let i = renderIndex;">
            <mat-form-field appearance="none">
              <textarea matInput style="width: 30px;" cdkTextareaAutosize #autosize="cdkTextareaAutosize"
                cdkAutosizeMinRows="1" cdkAutosizeMaxRows="6" [(ngModel)]="row.baseScore" [readonly]="true"></textarea>
              <textarea matInput style="width: 65px;" cdkTextareaAutosize #autosize="cdkTextareaAutosize"
                cdkAutosizeMinRows="1" cdkAutosizeMaxRows="6" [(ngModel)]="row.baseSeverity"
                [readonly]="true"></textarea>
            </mat-form-field>
          </td>
        </ng-container>
        <ng-container matColumnDef="treatment">
          <th mat-header-cell *matHeaderCellDef> Treatment </th>
          <td mat-cell *matCellDef="let row; let i = renderIndex" class="fullWidthInputColumn">
            <div class="vulnerability-treatment">
              <!-- <mat-form-field floatLabel="never"> -->
              <!-- <mat-select inputchange property="treatment"
                  [(ngModel)]="row.treatment" *ngIf="!row.reviewed">
                  <mat-option *ngFor="let treatment of treatments; trackBy: trackByTreatment" [value]="treatment">
                    {{treatment}}
                  </mat-option>
                </mat-select> -->
              <input matInput property="treatment" [readonly]="true" [ngModel]="row.treatment">
              <!-- </mat-form-field> -->
            </div>
          </td>
        </ng-container>
        <ng-container matColumnDef="reviewed">
          <th mat-header-cell *matHeaderCellDef> Reviewed </th>
          <td mat-cell *matCellDef="let row">
            {{convertBoolToYesNo(row.reviewed)}}
          </td>
        </ng-container>
        <ng-container matColumnDef="validated">
          <th mat-header-cell *matHeaderCellDef> Validated </th>
          <td mat-cell *matCellDef="let row; let i = renderIndex">
            {{convertBoolToYesNo(row.validated)}}
          </td>
        </ng-container>
        <ng-container matColumnDef="linkToWeakness">
          <th mat-header-cell *matHeaderCellDef> Link to Weakness </th>
          <td mat-cell *matCellDef="let row; let i = renderIndex">
            <div style="display:flex;">
              <mat-checkbox [disabled]="row.gen" [(ngModel)]="row.linked" (change)="linkedChanged($event,row)">
                {{convertBoolToYesNo(row.linked)}}
              </mat-checkbox>
              <mat-icon (click)="generateVulnerability()" style="padding-left:6px;font-weight:600;cursor:pointer" *ngIf="row.gen" color="warn">clear</mat-icon>
            </div>

          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; let i=index; columns: displayedColumns;" class="threat-row"
          [style.background-color]="row|rowColor" [id]="row._id">
        </tr>
      </table>
      <mat-paginator [pageSize]="5" showFirstLastButtons></mat-paginator>
    </div>
  </div>
</div>
<div class="vulnerabilityDialogButtons">
  <button mat-raised-button color="primary" [disabled]="generatedVulnerability" style="margin-right:auto" (click)="generateVulnerability()">Generate Vulnerability from this Weakness</button>
  <button mat-raised-button color="primary" style="margin-right:17px;" (click)="postData()">Confirm</button>
  <button mat-raised-button style="margin-right:65px;" (click)="closeDialog()">Cancel</button>
</div>
<ngx-spinner name="vulnerability-spinner"></ngx-spinner>
<!-- <div class="notifications-details-actions" *ngIf="!loadingDoneV">
<button mat-raised-button color="primary" (click)="loadMoreV()">Load More</button>
</div>  -->