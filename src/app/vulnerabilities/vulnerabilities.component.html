<div class="vulnerability-table-view-container">
    <div id="vulnerability-table-view">
      <div class="vulnerability-list-filter">
        <mat-form-field id="vulnerability-filter-section" style="text-align:left">
          <mat-label>Search</mat-label>
          <input matInput (input)="search($event)" placeholder="Search" #searchInput>
        </mat-form-field>
        <button id="refresh-vulnerability-list" mat-raised-button (click)="refreshTable()" color="gray">
          Refresh
        </button>
      </div>
      <div class="vulnerability-list-table-container" id="myId">
        <table mat-table [dataSource]="dataSource" matSort multiTemplateDataRows>
          <ng-container matColumnDef="no">
            <th mat-header-cell *matHeaderCellDef> No. </th>
            <td mat-cell *matCellDef="let row">
                {{row.no}}
            </td>
          </ng-container>
          <ng-container matColumnDef="component">
            <th mat-header-cell *matHeaderCellDef> Component </th>
            <td mat-cell *matCellDef="let row; let i = renderIndex;">
              <mat-form-field appearance="none">
                <textarea [readonly]="true" matInput placeholder="Component" style="padding-top:10px;"
                  cdkTextareaAutosize #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="1" cdkAutosizeMaxRows="6"
                  [(ngModel)]="row.component"></textarea>
              </mat-form-field>
            </td>
           </ng-container>
           <ng-container matColumnDef="swhw">
            <th mat-header-cell *matHeaderCellDef> SW/HW </th>
            <td mat-cell *matCellDef="let row; let i = renderIndex;">
              <!-- <ng-container> -->
                <mat-form-field appearance="none">
                  <textarea matInput placeholder="SW/HW"
                  [(ngModel)]="row.swhw" [readonly]="true" cdkTextareaAutosize #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="1" cdkAutosizeMaxRows="6"></textarea>
                </mat-form-field>
                <!-- <mat-button-toggle-group class="swhw" (change)="swhwChanged($event, row)" *ngIf="row.vulnerabilitySource =='userManual'" name="swhw" aria-label="swhw">
                  <mat-button-toggle checked="true" value="sw">SW</mat-button-toggle>
                  <mat-button-toggle value="hw">HW</mat-button-toggle>
                </mat-button-toggle-group> -->
            </td>
           </ng-container>
           <ng-container matColumnDef="cveid">
            <th mat-header-cell *matHeaderCellDef> CVE ID </th>
            <td mat-cell *matCellDef="let row; let i = renderIndex;" (click)="$event.stopPropagation()">
              <a href="{{'https://nvd.nist.gov/vuln/detail/'+ row.cveDataMetaIds}}" target="_blank">{{row.cveDataMetaIds}}</a>

                <!-- <mat-form-field appearance="none">
                  <textarea matInput inputchange placeholder="CVE ID" class="cveTextArea"
                  cdkTextareaAutosize #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="1" cdkAutosizeMaxRows="6"
                  ></textarea>
                </mat-form-field>
               -->
            </td>
           </ng-container>
           <ng-container matColumnDef="publishDate">
            <th mat-header-cell *matHeaderCellDef> Published Date </th>
            <td mat-cell *matCellDef="let row; let i = renderIndex;">
              {{row.publishedDate|date:'shortDate'}}
            </td>
           </ng-container>
           <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef> Description </th>
            <td mat-cell *matCellDef="let row; let i = renderIndex;">
                <textarea class="vulnerability-description"
                  matInput inputchange placeholder="Description"
                  [(ngModel)]="row.description" [readonly]="true"></textarea>
            </td>
          </ng-container>
           <ng-container matColumnDef="baseScore">
            <th mat-header-cell *matHeaderCellDef> Base Score </th>
            <td mat-cell *matCellDef="let row; let i = renderIndex;">
              <mat-form-field appearance="none">
                <textarea matInput style="width: 30px;"
                  cdkTextareaAutosize #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="1" cdkAutosizeMaxRows="6"
                  [(ngModel)]="row.baseScore"
                  [readonly]="true"></textarea>
                  <textarea matInput style="width: 65px;" 
                  cdkTextareaAutosize #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="1" cdkAutosizeMaxRows="6"
                  [(ngModel)]="row.baseSeverity" [readonly]="true"></textarea>
              </mat-form-field>
            </td>
           </ng-container>
           <ng-container matColumnDef="treatment">
            <th mat-header-cell *matHeaderCellDef> Treatment </th>
            <td mat-cell *matCellDef="let row; let i = renderIndex" class="fullWidthInputColumn">
              <div class="vulnerability-treatment">
                <!-- <mat-form-field floatLabel="never"> -->
                  <!-- <mat-select inputchange property="treatment"
                    [(ngModel)]="row.treatment" *ngIf="!row.reviewed">
                    <mat-option *ngFor="let treatment of treatments; trackBy: trackByTreatment" [value]="treatment">
                      {{treatment}}
                    </mat-option>
                  </mat-select> -->
                  <input matInput property="treatment"
                    [readonly]="true" [ngModel]="row.treatment">
                <!-- </mat-form-field> -->
              </div>
            </td>
          </ng-container>
          <ng-container matColumnDef="reviewed">
            <th mat-header-cell *matHeaderCellDef> Reviewed </th>
            <td mat-cell *matCellDef="let row">
              {{convertBoolToYesNo(row.reviewed)}}
            </td>
          </ng-container>
          <ng-container matColumnDef="validated">
            <th mat-header-cell *matHeaderCellDef> Validated </th>
            <td mat-cell *matCellDef="let row; let i = renderIndex">
                {{convertBoolToYesNo(row.validated)}}
            </td>
          </ng-container>
        
          <ng-container matColumnDef="linkedWeaknesses">
            <th mat-header-cell *matHeaderCellDef>Weaknesses Linked</th>
            <td mat-cell *matCellDef="let row; let i = renderIndex">
                {{row.linkedWeaknesses.length}}
            </td>
        </ng-container> 

          <ng-container matColumnDef="tableOp">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let row; let i = index" (click)="$event.stopPropagation()">
            <button [disabled]="editDesignShared.projectStatus?.milestoneView" mat-raised-button [matMenuTriggerFor]="threatBtnMenu">
                <mat-icon>more_horiz</mat-icon>
                </button>
              <mat-menu #threatBtnMenu="matMenu">
                <button mat-menu-item (click)="deleteRow(row)" [disabled]="row.reviewed">
                  <mat-icon>remove</mat-icon>
                  Delete Vulnerability
                </button>
                <button mat-menu-item (click)="openDialog({},'added')">
                  <mat-icon>add</mat-icon>
                  Add New Vulnerability
                </button>
                <button mat-menu-item (click)="linkWeaknesses(row)">
                  <mat-icon>link</mat-icon>
                  Link Weaknesses
                </button>
                <button mat-menu-item (click)="toggleHighlight(row)">
                  <mat-icon>help_outline</mat-icon>
                  {{ row.highlighted ? "Remove Highlight" : "Highlight" }}
                </button>
              </mat-menu>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; let i=index; columns: displayedColumns;" class="threat-row"
            [style.background-color]="row|rowColor" [id]="row._id" (click)="openDialog(row,'updated')">
          </tr>
        </table>
        <mat-paginator [pageSizeOptions]="[10, 20, 50]" showFirstLastButtons></mat-paginator>
      </div>
    </div>
  </div>
<button [disabled]="editDesignShared.projectStatus?.milestoneView"  *ngIf="dataSource.data.length == 0" class="add-new-btn" mat-raised-button (click)="openDialog({},'added')">+ Add New Vulnerbility</button>
<ngx-spinner name="vulnerability-spinner"></ngx-spinner>
<!-- <div class="notifications-details-actions" *ngIf="!loadingDoneV">
  <button mat-raised-button color="primary" (click)="loadMoreV()">Load More</button>
</div>  -->
